# Use zsh
set -g default-shell /bin/zsh

# Look good
set -g default-terminal 'xterm-256color'
set -ga terminal-overrides ",xterm-256color:Tc"

# Use Vim Tmuxline generated theme
source ~/.dotfiles/tmuxline.conf

# Refresh status line at regular intervals
set -g status-interval 2

# Highlight windows on activity
setw -g monitor-activity on

# Don't crop larger monitor when using multiple monitors
setw -g aggressive-resize on

# focus events enabled for terminals that support them
set -g focus-events on

# Default pane settings
setw -g other-pane-width 80
setw -g other-pane-height 20
setw -g allow-rename off
setw -g automatic-rename off

# Responsive layouts
# TODO: Not working
#cols='tput cols'
#if '[ $cols -le 280 ]' 'setw -g main-pane-width 100'
#if '[ `./scripts/screen-width.sh | bc` -le 1920 ]' \
  #'setw -g main-pane-width 100'

# More history
set -g history-limit 10000

# Display Tmux messages longer
set -g display-time 4000

# Use a mouse (Tmux >= v2.1)
set -g mouse on
bind-key -T root WheelUpPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
bind-key -T root WheelDownPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; send-keys -M"
bind-key -t vi-copy WheelUpPane halfpage-up
bind-key -t vi-copy WheelDownPane halfpage-down

# OSX clipboard hack
# NOTE: Technically no longer needed as of OSX Yosemite, but `grunt-concurrent`
# doesn't work in Tmux without it.
#set -g default-command "reattach-to-user-namespace -l zsh"
#bind y run "tmux save-buffer - | reattach-to-user-namespace pbcopy"
#unbind -t vi-copy Enter
#bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"


# KEYBINDINGS #

# Get rid of keymap lag
set -sg escape-time 0

# Xterm keybindings
setw -g xterm-keys on

# Page through history
bind-key -T root PPage if-shell -F "#{alternate_on}" "send-keys PPage" "copy-mode -e; send-keys PPage"
bind-key -t vi-copy PPage page-up
bind-key -t vi-copy NPage page-down

# Splitting windows
bind-key | split-window -h
bind-key - split-window

# Act like vim
setw -g mode-keys vi
bind ` copy-mode
unbind [
unbind p
bind p paste-buffer
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-selection
bind -t vi-copy Escape cancel

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Restore the default clear-screen binding
bind C-l send-keys 'C-l'


# PLUGINS #

# Change TPM plugin installation directory
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.config/tmux/plugins/'

# List of plugins
set -g @tpm_plugins '                 \
  tmux-plugins/tpm                    \
  tmux-plugins/tmux-copycat           \
  tmux-plugins/tmux-cpu               \
  tmux-plugins/tmux-prefix-highlight  \
  tmux-plugins/tmux-yank              \
'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.dotfiles/libs/tpm/tpm'
